{% extends 'advepa/elements/layouts/admin.html' %}
{% load static %}

<!-- Additional Css -->
{% block additional_css %}

{% endblock %}


{% block content %}

    {% include 'advepa/elements/alert.html' %}

    <div class="row">
        <div class="col-xl-12 col-lg-24 col-sm-24">
            <div class="widget-stat card">
                <div class="card-body p-4">
                    <h4 class="card-title">Accessi degli ultimi 7 giorni</h4>
                    <h3>{{ actions_last_7_days }}</h3>
                    <div class="progress mb-2">
                        <div class="progress-bar progress-animated bg-primary"
                             style="width: {{ percentage_last_24_hours }}%"></div>
                    </div>
                    <small>{{ percentage_last_24_hours }}% nelle ultime 24 ore</small>
                </div>
            </div>
        </div>
        <div class="col-xl-9 col-lg-18 col-sm-18">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">Grafico degli accessi alla piattaforma</h4>
                </div>
                <div class="card-body">
                    <ul class="nav nav-pills mb-4 light">
                        <li class=" nav-item">
                            <a href="#navpills-1" class="nav-link active" data-bs-toggle="tab" aria-expanded="false">
                                Grafico a barre</a>
                        </li>
                        <li class="nav-item">
                            <a href="#navpills-2" class="nav-link" data-bs-toggle="tab" aria-expanded="false">
                                Grafico a linee</a>
                        </li>
                        <li class="nav-item">
                            <a href="#navpills-3" class="nav-link" data-bs-toggle="tab" aria-expanded="true">
                                Grafico ad area</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div id="navpills-1" class="tab-pane active">
                            <div class="row">
                                <div class="col-md-12">
                                    <canvas id="barChart_2"></canvas>
                                </div>
                            </div>
                        </div>
                        <div id="navpills-2" class="tab-pane">
                            <div class="row">
                                <div class="col-md-12">
                                    <canvas id="lineChart_2"></canvas>
                                </div>
                            </div>
                        </div>
                        <div id="navpills-3" class="tab-pane">
                            <div class="row">
                                <div class="col-md-12">
                                    <canvas id="areaChart_2"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-xl-3 col-lg-6 col-sm-6">
            <form id="filter-form" method="POST" action="{% url 'advepa:access' %}">
                {% csrf_token %}
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Filtri di visualizzazione</h4>
                    </div>
                    <div class="card-body">
                        <div class="tab-width-icon">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#graph_filter_access">
                                        <span>
                                            <i class="ti-user"></i>
                                        </span>
                                    </a>
                                </li>
                                <a class="nav-link" data-bs-toggle="tab" href="#graph_filter_calendar">
                                        <span>
                                            <i class="ti-calendar"></i>
                                        </span>
                                </a>
                                </li>
                            </ul>
                            <!-- Tab panes -->
                        </div>
                        <div class="tab-content tabcontent-border">
                            <div class="tab-pane fade show active" id="graph_filter_access" role="tabpanel">
                                <div class="pt-4">
                                    <div id="platform">
                                        <div class="mb-4">
                                            <h4 class="card-title">Seleziona l'utente</h4>
                                        </div>
                                        <select id="user-select" name="user-select">
                                            <option value="all" {% if selected_user == 'all' %}selected{% endif %}>
                                                Tutti
                                            </option>
                                            {% for user in user_list %}
                                                <option value="{{ user.id }}"
                                                        {% if selected_user == user.id %}selected{% endif %}>{{ user.username }}
                                                    ({{ user.email }})
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="graph_filter_calendar" role="tabpanel">
                                <div class="pt-4">
                                    <div id="date-interval">
                                        <div class="mb-4">
                                            <h4 class="card-title">Seleziona l'intervallo di tempo</h4>
                                        </div>
                                        <select id="date-interval-select" name="date-interval-select">
                                            <option value="all"
                                                    {% if selected_date_interval == 'all' %}selected{% endif %}>Tutti
                                            </option>
                                            <option value="lastseven"
                                                    {% if selected_date_interval == 'lastseven' %}selected{% endif %}>
                                                Ultimi 7 giorni
                                            </option>
                                            <option value="lastfourteen"
                                                    {% if selected_date_interval == 'lastfourteen' %}selected{% endif %}>
                                                Ultimi 14 giorni
                                            </option>
                                            <option value="lastthirty"
                                                    {% if selected_date_interval == 'lastthirty' %}selected{% endif %}>
                                                Ultimi 30 giorni
                                            </option>
                                            <option value="lastninety"
                                                    {% if selected_date_interval == 'lastninety' %}selected{% endif %}>
                                                Ultimi 90 giorni
                                            </option>
                                            <option value="lastyear"
                                                    {% if selected_date_interval == 'lastyear' %}selected{% endif %}>
                                                Ultimo anno
                                            </option>
                                        </select>
                                    </div>
                                    <br/>
                                    <div id="date-start-end">
                                        <div class="mb-4">
                                            <h4 class="card-title">Seleziona la data di inizio e di fine</h4>
                                            <input class="form-control input-daterange-datepicker" type="text"
                                                   name="date-range" id="date-range" value="{{ selected_date_range }}">
                                        </div>
                                    </div>

                                    <div class="form-group mb-0">
                                        <label class="radio-inline me-3"><input type="radio" name="date-radio"
                                                                                class="form-check-input"
                                                                                value="interval"
                                                                                {% if selected_date_radio == 'interval' %}checked{% endif %}>
                                            Intervalli
                                            date
                                        </label>
                                        <label class="radio-inline me-3"><input type="radio" name="date-radio"
                                                                                class="form-check-input" value="range"
                                                                                {% if selected_date_radio == 'range' %}checked{% endif %}>
                                            Range date
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">

                        <p class="d-inline">
                            <button type="button" class="btn btn-rounded btn-outline-light">Reset</button>
                        </p>
                        <p class="float-end">
                            <button type="submit" class="btn btn-rounded btn-secondary">Aggiorna</button>
                        </p>

                    </div>
                </div>
            </form>
        </div>
    </div>



{% endblock %}

{% block additional_js %}
    <script id="picker">$(function () {
        $('input[name="date-range"]').daterangepicker({});
    });
    </script>
    <script id="charts">
        var barChart2 = function () {
            if (jQuery('#barChart_2').length > 0) {

                //gradient bar chart
                const barChart_2 = document.getElementById("barChart_2").getContext('2d');
                //generate gradient
                const barChart_2gradientStroke = barChart_2.createLinearGradient(0, 0, 0, 250);
                barChart_2gradientStroke.addColorStop(0, "rgba(41,83,232,1)");
                barChart_2gradientStroke.addColorStop(1, "rgba(41,83,232,0.5)");

                barChart_2.height = 100;

                new Chart(barChart_2, {
                    type: 'bar',
                    data: {
                        defaultFontFamily: 'Poppins',
                        labels: {{ chart_labels|safe }},
                        datasets: [
                            {
                                label: "Numero di accessi",
                                data: {{ chart_data|safe }},
                                borderColor: barChart_2gradientStroke,
                                borderWidth: "0",
                                backgroundColor: barChart_2gradientStroke,
                                hoverBackgroundColor: barChart_2gradientStroke,
                                barThickness: 50,
                            }
                        ]
                    },
                    options: {
                        plugins: {
                            legend: false
                        },
                        scales: {
                            y: {
                                ticks: {
                                    beginAtZero: true
                                }
                            },
                            x: {
                                barPercentage: 0.5
                            }
                        }
                    }
                });
            }
        }
        var lineChart2 = function () {
            //gradient line chart
            if (jQuery('#lineChart_2').length > 0) {

                const lineChart_2 = document.getElementById("lineChart_2").getContext('2d');
                //generate gradient
                const lineChart_2gradientStroke = lineChart_2.createLinearGradient(500, 0, 100, 0);
                lineChart_2gradientStroke.addColorStop(0, "rgba(41,83,232,1)");
                lineChart_2gradientStroke.addColorStop(1, "rgba(41,83,232,1)");

                /* Chart.controllers.line = Chart.controllers.line.extend({
                    draw: function () {
                        draw.apply(this, arguments);
                        let nk = this.chart.chart.ctx;
                        let _stroke = nk.stroke;
                        nk.stroke = function () {
                            nk.save();
                            nk.shadowColor = 'rgba(0, 0, 128, .2)';
                            nk.shadowBlur = 10;
                            nk.shadowOffsetX = 0;
                            nk.shadowOffsetY = 10;
                            _stroke.apply(this, arguments)
                            nk.restore();
                        }
                    }
                }); */

                lineChart_2.height = 100;

                new Chart(lineChart_2, {
                    type: 'line',
                    data: {
                        defaultFontFamily: 'Poppins',
                        labels: {{ chart_labels|safe }},
                        datasets: [
                            {
                                label: "Numero di accessi",
                                data: {{ chart_data|safe }},
                                borderColor: lineChart_2gradientStroke,
                                borderWidth: "2",
                                backgroundColor: 'transparent',
                                pointBackgroundColor: 'rgba(235, 129, 83, 0.5)',
                                tension: 0.5,
                            }
                        ]
                    },
                    options: {
                        plugins: {
                            legend: false
                        },
                        scales: {
                            y: {
                                ticks: {
                                    beginAtZero: true,
                                    max: 100,
                                    min: 0,
                                    stepSize: 20,
                                    padding: 10
                                }
                            },
                            x: {
                                ticks: {
                                    padding: 5
                                }
                            }
                        }
                    }
                });
            }
        }
    </script>
{% endblock %}